"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4456],{31181:function(e,t,l){l.d(t,{z:function(){return g}});var n=l(67294),i=l(50361),a=l.n(i),o=l(36188),r=l(32751),u=l(87598),d=l(66830),s=l(42209),c=l(14484),v=l(51143);let p=(e,t)=>{let l="".concat(s.apiBaseUrl,"/api/v1/image/pinned/").concat(e);return(0,u.uz)(l,{},{headers:{"X-CSRF-Token":t}})},g=()=>{let{token:e}=(0,c.EC)(),t=(0,r.Z)(),l=(0,o.D)({mutationFn:t=>{let{id:l}=t;return p(l,e)},onSuccess:(e,l)=>{let{id:n}=l,i=t.mutate(d.O.Images(),e=>e.pinterest_filter&&1===(0,v.w2)(e.pinterest_filter),t=>{let l=t.results.findIndex(e=>e.id===n);if(t.results[l]){let n=a()(t),i=(0,v.w2)(n.results[l].pinterest_viewed_user_remaining,0),o=(0,v.w2)(n.results[l].pinterest_counts_required,0)-e.count,r=n.pinterest_totals.user_remaining;return n.results[l].pinterest_viewed_user_remaining=Math.max(0,o),n.results[l].pinterest_counts_required=Math.max(0,o),n.pinterest_totals.user_remaining=r-(i-Math.max(0,o)),0===o&&(n.results.splice(l,1),n.total-=1),n}return null});return i.commit(),{transaction:i}},onError:(e,t,l)=>{let{transaction:n}=l;n.rollback()}});return{set:(0,n.useCallback)(e=>l.mutate({id:e}),[l])}}},41383:function(e,t,l){l.d(t,{BD:function(){return _},Ij:function(){return y},JP:function(){return k},RW:function(){return g},U9:function(){return h},Vc:function(){return m},rN:function(){return b},tj:function(){return f}});var n=l(58261),i=l.n(n),a=l(274),o=l(7517),r=l(13155),u=l(49785),d=l(31972),s=l(7294),c=l(65118),v=l(29428),p=l(68365);let g=6,f=(e,t,l)=>{var n;let i=e.display_image_width||e.width||1,a=e.display_image_height||e.height||1;return(null==e?void 0:null===(n=e.metadata)||void 0===n?void 0:n.isPrint)&&l<p.tu?2*g+a/i*(t-2*g):a/i*t},h=(e,t)=>{let[l,n]=(0,d.pF)(e.width,e.height,e.units);return t/(l/n)},m=(e,t,l)=>{let n=(e,t)=>{let l=new u.Z(e);return t&&l.pushFilter(t,"tags_or"),l.toString()},i=[];return t&&i.push({label:"Add-on",queries:{tags:"$addons",topic_group:"$addons"},pathQuery:n(a.X3)}),"layerphoto"===e?i.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:n(a.bj,"$jpegtiff")},{label:"PSD",queries:{tags_or:"$psd"},pathQuery:n(a.bj,"$psd")}):"vector"===e?i.push({label:"Vector",queries:{tags_or:"$vector"},pathQuery:n(a.bj,"$vector")}):"png"===e?i.push({label:"PNG",queries:{tags_or:"$png"},pathQuery:n(a.bj,"$png")}):"docx"===e?i.push({label:"Word",queries:{tags_or:"$docxpdf"},pathQuery:n(a.bj,"$docxpdf")}):"pdf"===e?i.push({label:"PDF",queries:{tags_or:"$pdf"},pathQuery:n(a.bj,"$pdf")}):l?i.push({label:"Font",queries:{tags:"$fonts",topic_group:"$fonts"},pathQuery:n(a.lH)}):i.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:n(a.bj,"$jpegtiff")}),i},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=o.sp.find(t=>e.includes(t));return t&&o.E1[t]?o.E1[t]:null},_=function(e){var t,l,n,a;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(o){let t=[];if(null==r?void 0:r.path){let e=new u.Z(r.path).pathParts.filter(e=>"group"===e.type&&e.id!==o.id).map(e=>e.id);e.length>0&&t.push(...e)}let l=u.Z.createPathFromTopicEntity(o,null,t);return w(l,e),"/create/design/".concat(e.design_id,"?").concat(i()({path:l.stringify(),tid:(null==e?void 0:null===(a=e.metadata)||void 0===a?void 0:a.templateId)||(null==e?void 0:e.id)},s.j1))}let d=b(null==e?void 0:null===(t=e.metadata)||void 0===t?void 0:t.createToolTopics),c=(null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.defaultCategoryId)||void 0,v=new u.Z;return(null==d?void 0:d.id)&&v.push(d.id),c&&v.push(c,"topic"),w(v,e),"/create/design/".concat(e.design_id,"?").concat(i()({path:v.length()?v.stringify():null,tid:(null==e?void 0:null===(n=e.metadata)||void 0===n?void 0:n.templateId)||(null==e?void 0:e.id)},s.j1))},w=(e,t)=>{var l,n,i,a,o;!((null===(l=t.metadata)||void 0===l?void 0:l.templateIsRemix)||(null===(i=t.metadata)||void 0===i?void 0:null===(n=i.createToolTopics)||void 0===n?void 0:n.includes(r.CREATE_REMIX_TAG)))&&((null==t?void 0:null===(a=t.metadata)||void 0===a?void 0:a.design_page_count)>1?e.set(t.id,"pages"):(null==t?void 0:null===(o=t.metadata)||void 0===o?void 0:o.hasSetGroup)&&e.set(t.id,"set"))},y=e=>[(null==e?void 0:e.display_image_width)||(null==e?void 0:e.width)||1,(null==e?void 0:e.display_image_height)||(null==e?void 0:e.height)||1],k=async(e,t)=>{try{let l=await (0,v.ny)(e.uid,e.id,t);(null==l?void 0:l.url)&&(0,c.O)(l.url)}catch(e){console.log(e)}}},49453:function(e,t,l){var n=l(67294),i=l(40144),a=l(16550),o=l(50361),r=l.n(o),u=l(10974),d=l(95448),s=l(96165),c=l(62359),v=l(20419),p=l(32360),g=l(14484),f=l(33818),h=l(66830),m=l(31181),b=l(64739),_=l(68365),w=l(34050),y=l(23555),k=l(228),C=l(8811);let T={};t.Z=(e,t,l,o)=>{var D,j;let{data:x}=(0,g.aF)(),F=(0,g.EC)(),$=F.isReady&&F.isLoggedIn,{data:q}=(0,b.Z0)($),{activeTeam:P}=(0,C.Z)(),{showUpgradeModal:E,showFreeSignupThrottledModal:R}=(0,y.Z)(),{setOpen:Z}=(0,u.Z)(),{setOpen:S}=(0,d.Z)(),I=(0,a.k6)(),Q=(0,p.R)(),{showRawpixelTeam:B}=(0,s.ZP)(),L=(0,c.Z)(_._y),{openSignupModal:M,closeModal:N}=(0,v.ZP)(),[O,A]=(0,n.useState)(!1),[G,z]=(0,n.useState)(),[H,U]=(0,n.useState)(!1),[X,V]=(0,n.useState)(),W=!!B&&!!(null==x?void 0:null===(D=x.access)||void 0===D?void 0:D.show_rawpixel_team),J=n.useMemo(()=>{var t;return null===(t=e||[])||void 0===t?void 0:t.filter(e=>null==e?void 0:e.id).map(e=>null==e?void 0:e.id)},[e]),{data:K=T}=(0,f.rc)("image",J,J.length>0&&!o),{set:Y}=(0,f.sj)(),{set:ee}=(0,m.z)(),et=(0,i.NL)(),el=n.useCallback(e=>{if(!L&&!W){null==e||e.preventDefault(),A(!0);return}},[W,L]),en=n.useCallback(e=>{if(!L&&!W){e.preventDefault(),A(!0);return}},[L,W]),ei=n.useCallback((e,t,n)=>{if(l){l(e,t,n);return}if("image"===e.type){et.setQueryData(h.O.ImageLocal({id:e.id}),{image:r()(e),placeHolderSrc:t});return}"template"===e.type&&el(n),"design"===e.type&&en(n)},[l,et,el,en]),ea=n.useCallback((e,t,l)=>{if(x&&x.uid>0)Y(x.uid,"image",t,l);else{var n,i;(null==x?void 0:null===(i=x.website_status)||void 0===i?void 0:null===(n=i.throttle_free_signup)||void 0===n?void 0:n.enabled)?R(!0):M()}},[x,Y,M,R]),eo=n.useCallback(function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if((null==x?void 0:x.uid)>0){e.stopPropagation(),e.preventDefault();let a=n.createRef();a.current=e.currentTarget,Z(a,t,l,i)}else{var a,o;(null==x?void 0:null===(o=x.website_status)||void 0===o?void 0:null===(a=o.throttle_free_signup)||void 0===a?void 0:a.enabled)?R(!0):M()}},[Z,null==x?void 0:x.uid,M,R,null==x?void 0:x.website_status]),er=n.useCallback((e,t,l)=>{e.stopPropagation(),e.preventDefault();let i=n.createRef();i.current=e.currentTarget,S(i,t,l)},[S]),eu=n.useCallback((e,l,n,i)=>{if(x&&x.uid>0){if(e.stopPropagation(),e.preventDefault(),"project"!==n)return;let{id:a}=t;Q(a,[{type:w.Uu[l.type],id:l.id}],"delete",i)}},[x,Q,t]),ed=n.useCallback((e,t)=>{x&&x.uid>0&&ee(t)},[x,ee]),es=n.useCallback(e=>{if(!L&&!W){null==e||e.preventDefault(),A(!0);return}},[W,L]),ec=n.useCallback((t,l)=>{let n=e.find(e=>e.id===l);if(n){if(x&&x.uid>0){var i,a,o,r,u,d,s,c;!x.is_free||x.free_premium_active||(null==n?void 0:null===(i=n.metadata)||void 0===i?void 0:i.isFreeLicense)||(null==n?void 0:null===(a=n.metadata)||void 0===a?void 0:a.isCC0License)?W||!x.is_free||x.free_premium_active||null==n||null===(o=n.metadata)||void 0===o||!o.isFreeLicense||(null==n?void 0:null===(r=n.metadata)||void 0===r?void 0:r.isCC0License)||(null==q?void 0:null===(u=q.limits)||void 0===u?void 0:u.unlimited)||!((null==q?void 0:null===(d=q.limits)||void 0===d?void 0:d.remaining)<=0)||(null==q?void 0:null===(c=q.limits)||void 0===c?void 0:null===(s=c.ids)||void 0===s?void 0:s.includes(null==n?void 0:n.id))?z(n):E({feature:k.HN,upgradeBoxType:"black"}):E({feature:k.D8,upgradeBoxType:"black",image:n})}else I.push("/user/register?destination=/image/".concat(l))}},[e,x,I,null==q?void 0:q.limits,W,E]),ev=n.useCallback((e,t)=>{U(!0),V(t)},[]),ep=n.useCallback(()=>{N(),A(!1),z(void 0)},[N]),eg=!!(null==x?void 0:x.uid)&&!!t&&((null==x?void 0:null===(j=x.access)||void 0===j?void 0:j.edit_any_board)||"user"===t.owner.type&&t.owner.id===(null==x?void 0:x.uid)||!!P&&"team"===t.owner.type&&t.owner.id===P.id),ef=n.useCallback(()=>{z(void 0),U(!1),V(null)},[]);return n.useMemo(()=>({onImageClick:ei,canDeleteFromProject:eg,onSaveClick:eo,onDotsMenuClick:er,onDeleteFromProjectClick:eu,onFavoriteClick:ea,onPinterestClick:ed,onAdjustmentClick:es,favorites:K,showEditRestrictedModal:O,closeModal:ep,onDownloadClick:ec,imageToDownload:G,closeDrawer:ef,onShareClick:ev,shareImage:X,shareDrawer:H}),[ei,eg,eo,er,eu,ea,ed,es,K,ep,ec,G,ef,ev,X,H,O])}},31972:function(e,t,l){l.d(t,{Mm:function(){return i},b7:function(){return n},jB:function(){return a},pF:function(){return o}});let n=96,i=300,a=150,o=function(e,t){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"px",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"px",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n,o="number"==typeof e?e:parseFloat(e),r="number"==typeof t?t:parseFloat(t);if(l===i)return[o,r];let u=a/2.54,d=null;switch(l){case"in":d=[o*a,r*a];break;case"cm":d=[o*u,r*u];break;case"px":d=[o,r];break;default:throw Error("Invalid unit value ".concat(l))}let[s,c]=d;switch(i){case"in":return[s/a,c/a];case"cm":return[s/u,c/u];case"px":return d;default:throw Error("Invalid unit value ".concat(i))}}},65118:function(e,t,l){l.d(t,{O:function(){return n},u:function(){return o}});let n=e=>{window.location.assign(e)},i=null,a=()=>{if("boolean"==typeof i)return i;if("undefined"==typeof ReadableStream||"undefined"==typeof Request||"undefined"==typeof Blob||"function"!=typeof new Blob().arrayBuffer)return i=!1;try{let e=!1,t=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");i=e&&!t}catch(e){i=!1}return i};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];{if(!t||(null==t?void 0:t.length)===0||!a()){window.location.assign(e);return}let r=[e,...t],u=0,d=Date.now();for(;r.length>0&&Date.now()-d<3e4;){let a=Date.now(),s=r.shift(),c=null,v=null,p=null,g=new AbortController;g.signal.onabort=e=>{var t;return null==e?void 0:null===(t=e.preventDefault)||void 0===t?void 0:t.call(e)};let f=setTimeout(()=>{g.signal.aborted||g.abort("Timeout. Download url is not reachable: "+s)},6500);try{(null==(c=await fetch(s,{method:"GET",signal:g.signal,credentials:"omit"}))?void 0:c.ok)||(p=!1,console.warn({message:"File connection failed ".concat(e,": ").concat(c.status," ").concat(c.statusText)}))}catch(t){g.signal.aborted?console.debug("Aborted. Timeout."):console.warn({message:"File connection failed ".concat(e,": ").concat(t.message),ok:null==c?void 0:c.ok,status:null==c?void 0:c.status}),p=!1}if(!1===p){try{clearTimeout(f),g.signal.aborted||g.abort("Done.")}catch(e){}u+=1;continue}if(!g.signal.aborted&&(null==c?void 0:c.ok)&&(null==c?void 0:c.status)===200){if(u>0||Date.now()-a>5e3)p=!0,console.debug("File connection ok. ".concat(0===u?"Triggered the original download url request, no test connection too slow. ".concat(Date.now()-a," ms."):"Triggering a mirror download url request. ".concat(Date.now()-a," ms, ").concat(u,"/").concat(t.length," mirror attempts.")));else{var l,n,i,o;let t=!c.body.locked&&(null==c?void 0:null===(n=c.body)||void 0===n?void 0:null===(l=n.getReader)||void 0===l?void 0:l.call(n));try{v=await t.read()}catch(l){console.warn({message:"File read failed ".concat(e,": ").concat(c.status," ").concat(c.statusText),error:l.message}),null==t||null===(o=t.cancel)||void 0===o||o.call(t).catch()}(null==v?void 0:null===(i=v.value)||void 0===i?void 0:i.byteLength)>1e3&&(p=!0,console.debug("File readable. Triggered the original download url request. ".concat(Date.now()-a," ms.")))}try{clearTimeout(f),g.signal.aborted||g.abort("Done.")}catch(e){}if(!0===p){console.debug("Triggered after ".concat(Date.now()-d," ms.")),window.location.assign(e);return}}u+=1}window.location.assign(e)}}}}]);